{"expireTime":9007200803979237000,"key":"transformer-remark-markdown-ast-40582457464ae924bd0b3c285b65bb06-gatsby-remark-prismjs-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"I've been messing around with live video capture in the browser and have developed a nifty demo showing different methods for estimating the quality of light in realtime.","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":171,"offset":170},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":171,"offset":170},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To view the demo you are going to need a web cam and a modern Chrome, Firefox or Opera browser. If you have what it takes you can ","position":{"start":{"line":3,"column":1,"offset":172},"end":{"line":3,"column":131,"offset":302},"indent":[]}},{"type":"link","title":null,"url":"http://codepen.io/MadeByMike/full/d8369096b18e2192d0c9d721b9b2a673/","children":[{"type":"text","value":"view my demo here","position":{"start":{"line":3,"column":132,"offset":303},"end":{"line":3,"column":149,"offset":320},"indent":[]}}],"position":{"start":{"line":3,"column":131,"offset":302},"end":{"line":3,"column":219,"offset":390},"indent":[]}},{"type":"text","value":". Please select allow when asked for permission to use the web cam.","position":{"start":{"line":3,"column":219,"offset":390},"end":{"line":3,"column":286,"offset":457},"indent":[]}}],"position":{"start":{"line":3,"column":1,"offset":172},"end":{"line":3,"column":286,"offset":457},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"These tests have some potential real world uses. For example to advise of optimal lighting in a camera app or to estimate the size of the subject in the frame.","position":{"start":{"line":5,"column":1,"offset":459},"end":{"line":5,"column":160,"offset":618},"indent":[]}}],"position":{"start":{"line":5,"column":1,"offset":459},"end":{"line":5,"column":160,"offset":618},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"A brief history of html video capture","position":{"start":{"line":7,"column":4,"offset":623},"end":{"line":7,"column":41,"offset":660},"indent":[]}}],"position":{"start":{"line":7,"column":1,"offset":620},"end":{"line":7,"column":41,"offset":660},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Before I explain my demo, it's worth sharing what I've learnt about the history of video capture and webRTC as well as its ","position":{"start":{"line":9,"column":1,"offset":662},"end":{"line":9,"column":124,"offset":785},"indent":[]}},{"type":"link","title":null,"url":"http://caniuse.com/#search=getusermedia","children":[{"type":"text","value":"state today","position":{"start":{"line":9,"column":125,"offset":786},"end":{"line":9,"column":136,"offset":797},"indent":[]}}],"position":{"start":{"line":9,"column":124,"offset":785},"end":{"line":9,"column":178,"offset":839},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":9,"column":178,"offset":839},"end":{"line":9,"column":179,"offset":840},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":662},"end":{"line":9,"column":179,"offset":840},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The first thing to know is, it had a bit of a rocky start. This history is well covered in ","position":{"start":{"line":11,"column":1,"offset":842},"end":{"line":11,"column":92,"offset":933},"indent":[]}},{"type":"link","title":null,"url":"http://www.html5rocks.com/en/tutorials/getusermedia/intro/","children":[{"type":"text","value":"this excellent HTML5rocks article","position":{"start":{"line":11,"column":93,"offset":934},"end":{"line":11,"column":126,"offset":967},"indent":[]}}],"position":{"start":{"line":11,"column":92,"offset":933},"end":{"line":11,"column":187,"offset":1028},"indent":[]}},{"type":"text","value":" by Eric Bidelman.","position":{"start":{"line":11,"column":187,"offset":1028},"end":{"line":11,"column":205,"offset":1046},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":842},"end":{"line":11,"column":205,"offset":1046},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The next thing to know is that ","position":{"start":{"line":13,"column":1,"offset":1048},"end":{"line":13,"column":32,"offset":1079},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">getUserMedia()</code>","position":{"start":{"line":13,"column":32,"offset":1079},"end":{"line":13,"column":48,"offset":1095},"indent":[]}},{"type":"text","value":" is still not fully supported in all browsers and there are some quirks (huge gaping inconsistencies) in implementation across browsers.","position":{"start":{"line":13,"column":48,"offset":1095},"end":{"line":13,"column":184,"offset":1231},"indent":[]}}],"position":{"start":{"line":13,"column":1,"offset":1048},"end":{"line":13,"column":184,"offset":1231},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Not to fear because web development superhero Addy Osmani and others have come to the rescue with pollyfills such as:","position":{"start":{"line":15,"column":1,"offset":1233},"end":{"line":15,"column":118,"offset":1350},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":1233},"end":{"line":15,"column":118,"offset":1350},"indent":[]}},{"type":"list","ordered":false,"start":null,"loose":false,"children":[{"type":"listItem","loose":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/addyosmani/getUserMedia.js/","children":[{"type":"text","value":"getUserMedia.js","position":{"start":{"line":17,"column":6,"offset":1357},"end":{"line":17,"column":21,"offset":1372},"indent":[]}}],"position":{"start":{"line":17,"column":5,"offset":1356},"end":{"line":17,"column":70,"offset":1421},"indent":[]}}],"position":{"start":{"line":17,"column":5,"offset":1356},"end":{"line":17,"column":70,"offset":1421},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":1352},"end":{"line":17,"column":70,"offset":1421},"indent":[]}},{"type":"listItem","loose":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/jhuckaby/webcamjs","children":[{"type":"text","value":"webcamjs","position":{"start":{"line":18,"column":6,"offset":1427},"end":{"line":18,"column":14,"offset":1435},"indent":[]}}],"position":{"start":{"line":18,"column":5,"offset":1426},"end":{"line":18,"column":53,"offset":1474},"indent":[]}}],"position":{"start":{"line":18,"column":5,"offset":1426},"end":{"line":18,"column":53,"offset":1474},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1422},"end":{"line":18,"column":53,"offset":1474},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":1352},"end":{"line":18,"column":53,"offset":1474},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"To keep it as simple as possible I haven't included any pollyfills in my demo, but I've tested them and they work, so there's no reason not to start using this now.","position":{"start":{"line":20,"column":1,"offset":1476},"end":{"line":20,"column":165,"offset":1640},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1476},"end":{"line":20,"column":165,"offset":1640},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Estimating the quality of lighting","position":{"start":{"line":22,"column":4,"offset":1645},"end":{"line":22,"column":38,"offset":1679},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":1642},"end":{"line":22,"column":38,"offset":1679},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In my demo there were 2 methods I trialed for determining the brightness.","position":{"start":{"line":24,"column":1,"offset":1681},"end":{"line":24,"column":74,"offset":1754},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":1681},"end":{"line":24,"column":74,"offset":1754},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The first method was to find the average color of all the pixels in the frame then work out the relative brightness of this color. This method worked really well, in most situations it gave a good indication of the general brightness and would be suitable for uses such as a light indicator in a camera app.","position":{"start":{"line":26,"column":1,"offset":1756},"end":{"line":26,"column":308,"offset":2063},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1756},"end":{"line":26,"column":308,"offset":2063},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"But eventually I found some limitations with the average color method when testing subjects with a high level of contrast. Images with a very dark background can give a false indication of the overall brightness and there is not enough information in the average color method to determine the 'quality' of light.","position":{"start":{"line":28,"column":1,"offset":2065},"end":{"line":28,"column":313,"offset":2377},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":2065},"end":{"line":28,"column":313,"offset":2377},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"I realised that I wanted to know not just the average brightness but also how much of the frame was lit. To do this I applied a threshold filter to the incoming video stream. The threshold filter determines the brightness of each pixel and sets it to either black or white depending on whether it's above or below a certian level of brightness. In the end I can tell what percentage of the frame is lit and this is number can be very differnt to the average brightness.","position":{"start":{"line":30,"column":1,"offset":2379},"end":{"line":30,"column":470,"offset":2848},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":2379},"end":{"line":30,"column":470,"offset":2848},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Used together we can determine a lot about the composition and lighting of the frame.","position":{"start":{"line":32,"column":1,"offset":2850},"end":{"line":32,"column":86,"offset":2935},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":2850},"end":{"line":32,"column":86,"offset":2935},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Taking it further","position":{"start":{"line":34,"column":4,"offset":2940},"end":{"line":34,"column":21,"offset":2957},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":2937},"end":{"line":34,"column":21,"offset":2957},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If I apply more than one threshold I can set a maximum and minimum brightness and measure which parts of the image are potentially under or over exposed.","position":{"start":{"line":36,"column":1,"offset":2959},"end":{"line":36,"column":154,"offset":3112},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":2959},"end":{"line":36,"column":154,"offset":3112},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Finally and it's not in my demo but you could potentially automatically adjust the threshold based on the average color brightness.  ","position":{"start":{"line":38,"column":1,"offset":3114},"end":{"line":38,"column":134,"offset":3247},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":3114},"end":{"line":38,"column":134,"offset":3247},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"So there we have a ton of information we can use to make inferences about the quality of lighting in a video stream. Now it's up to you work out how to put them to practical application.","position":{"start":{"line":40,"column":1,"offset":3249},"end":{"line":40,"column":187,"offset":3435},"indent":[]}}],"position":{"start":{"line":40,"column":1,"offset":3249},"end":{"line":40,"column":187,"offset":3435},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Performance tips","position":{"start":{"line":42,"column":4,"offset":3440},"end":{"line":42,"column":20,"offset":3456},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":3437},"end":{"line":42,"column":20,"offset":3456},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Despite being very poorly optomised my demo seems to run ok. Not only am I adjusting the brightness before rendering each frame to a canvas, I'm also showing the results of the threshold and average filters on a separate smaller canvas. In most cases you won't need to do either of these things.","position":{"start":{"line":44,"column":1,"offset":3458},"end":{"line":44,"column":296,"offset":3753},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":3458},"end":{"line":44,"column":296,"offset":3753},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"I was able to get these methods working on an average machine with a HD video input by combining each of the filters so that I was only looping over the pixel data once. I used an off screen canvas and only processed every 5th frame and every 5th pixel. The results were as accurate as the method shown in this demo.","position":{"start":{"line":46,"column":1,"offset":3755},"end":{"line":46,"column":317,"offset":4071},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":3755},"end":{"line":46,"column":317,"offset":4071},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Further reading","position":{"start":{"line":48,"column":4,"offset":4076},"end":{"line":48,"column":19,"offset":4091},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":4073},"end":{"line":48,"column":19,"offset":4091},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Interesting articles I found along the way include:","position":{"start":{"line":50,"column":1,"offset":4093},"end":{"line":50,"column":52,"offset":4144},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":4093},"end":{"line":50,"column":52,"offset":4144},"indent":[]}},{"type":"list","ordered":false,"start":null,"loose":false,"children":[{"type":"listItem","loose":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://dev.opera.com/articles/getusermedia-access-camera-privacy-ui/","children":[{"type":"text","value":"getUserMedia: Accessing the Camera and Privacy UI","position":{"start":{"line":52,"column":4,"offset":4149},"end":{"line":52,"column":53,"offset":4198},"indent":[]}}],"position":{"start":{"line":52,"column":3,"offset":4148},"end":{"line":52,"column":125,"offset":4270},"indent":[]}},{"type":"text","value":" - Bruce Lawson","position":{"start":{"line":52,"column":125,"offset":4270},"end":{"line":52,"column":140,"offset":4285},"indent":[]}}],"position":{"start":{"line":52,"column":3,"offset":4148},"end":{"line":52,"column":140,"offset":4285},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":4146},"end":{"line":52,"column":140,"offset":4285},"indent":[]}},{"type":"listItem","loose":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"http://www.html5rocks.com/en/tutorials/getusermedia/intro/","children":[{"type":"text","value":"Capturing Audio & Video in HTML5","position":{"start":{"line":53,"column":4,"offset":4289},"end":{"line":53,"column":36,"offset":4321},"indent":[]}}],"position":{"start":{"line":53,"column":3,"offset":4288},"end":{"line":53,"column":97,"offset":4382},"indent":[]}},{"type":"text","value":" - Eric Bidelman","position":{"start":{"line":53,"column":97,"offset":4382},"end":{"line":53,"column":113,"offset":4398},"indent":[]}}],"position":{"start":{"line":53,"column":3,"offset":4288},"end":{"line":53,"column":113,"offset":4398},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":4286},"end":{"line":53,"column":113,"offset":4398},"indent":[]}},{"type":"listItem","loose":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"http://www.sitepoint.com/introduction-getusermedia-api/","children":[{"type":"text","value":"introduction to the getUserMedia API","position":{"start":{"line":54,"column":4,"offset":4402},"end":{"line":54,"column":40,"offset":4438},"indent":[]}}],"position":{"start":{"line":54,"column":3,"offset":4401},"end":{"line":54,"column":98,"offset":4496},"indent":[]}},{"type":"text","value":" - Aurelio De Rosa","position":{"start":{"line":54,"column":98,"offset":4496},"end":{"line":54,"column":116,"offset":4514},"indent":[]}}],"position":{"start":{"line":54,"column":3,"offset":4401},"end":{"line":54,"column":116,"offset":4514},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":4399},"end":{"line":54,"column":116,"offset":4514},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":4146},"end":{"line":54,"column":116,"offset":4514},"indent":[1,1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":55,"column":1,"offset":4515}}}}